<?xml version="1.0" encoding="UTF-8"?>
<databaseChangeLog xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
                   https://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-latest.xsd">

    <changeSet id="001_DIAMOND_CREATE" author="${author}">
        <sql dbms="postgresql">
            CREATE TABLE public.diamond
            (
                id               BIGINT GENERATED BY DEFAULT AS IDENTITY                                  NOT NULL,
                parcel_name      VARCHAR(256)                                                             NOT NULL,
                size_from        numeric(4, 2)                                                            NOT NULL,
                size_to          numeric(4, 2)                                                            NOT NULL,
                size_name        varchar(16) GENERATED ALWAYS AS (size_from || ' to ' || size_to) STORED  NOT NULL,
                quality_type     VARCHAR(24)                                                              NOT NULL,
                stone_carat      numeric(8, 5)                                                            NOT NULL,
                stone_price      numeric(13, 3)                                                           NOT NULL,
                quantity         int                                                                      NOT NULL,
                carat_left       numeric GENERATED ALWAYS AS (stone_carat * quantity) STORED              NOT NULL,
                total_price      numeric GENERATED ALWAYS AS (stone_price * quantity) STORED              NOT NULL,
                diamond_shape_id BIGINT                                                                   NOT NULL,
                supplier_id      BIGINT                                                                   NOT NULL,
                CONSTRAINT diamond_pkey PRIMARY KEY (id)
            );
        </sql>

        <addForeignKeyConstraint constraintName="fk_diamond__diamond_shape"
                                 baseTableName="diamond" baseColumnNames="diamond_shape_id"
                                 referencedTableName="diamond_shape" referencedColumnNames="id"/>
        <addForeignKeyConstraint constraintName="fk_diamond__supplier"
                                 baseTableName="diamond" baseColumnNames="supplier_id"
                                 referencedTableName="supplier" referencedColumnNames="id"/>
    </changeSet>
</databaseChangeLog>
